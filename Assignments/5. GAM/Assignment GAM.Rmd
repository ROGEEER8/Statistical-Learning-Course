---
title: 'Assignment 5: GAM'
author: "Víctor Villegas, Roger Llorenç, Luis Sierra"
date: "2024-03-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Clears plots
while (dev.cur() != 1) {
  dev.off()
}
# Clears global environment
rm(list = ls())

set.seed(1234)
```

### Initial remark: double-blind trials

(Taken from [this](https://www.news-medical.net/health/What-is-a-Double-Blind-Trial.aspx) website)

In double-blind trials, the treatment patients have is unknown to both patients and doctors until after the study is concluded. This differs from other types of trials, such as simple blind trials where only the patients are unaware of the treatment they are receiving, whereas the doctors know.

Double-blind trials are a form of randomized trials and can be ‘upgraded’ to triple-blind trials, in which the statisticians or data clean-up personnel are also blind to treatments.

To be effective, it is generally recommended that double-blind trials include around 100-300 people. If treatments are highly effective, smaller numbers can be used but if only 30 or so patients are enrolled the study is unlikely to be beneficial.

The assignment of patients into treatments is typically done by computers, where the computer assigns each patient a code number and treatment group. The doctor and patients only know the code number to avoid bias, hence allowing the study to be double-blind.

## GAMs for hirsutism data

In this report we'll several GAM models (including semi-parametric models) explaining `FGm12` as a function of the variables that were measured at the beginning of the clinical trial and Treatment (treated as factor, which can by used as value of parameter by in function `s()`).

One of the advantages of GAM models is that they can overcome the curse of dimensionality.

Then we use functions `summary`, `plot`, `vis.gam` and `gam.check` to get an insight into the fitted models.

To do this, we will be using the following variables:

-   `Treatment`, with values 0 to 3.
-   `FGm0`, always greater than 15. Indicates the baseline hirsutism level at the randomization
-   `SysPres`, baseline systolic blood pressure.
-   `DiaPres`, baseline diastolic blood pressure.
-   `weight`
-   `height`

*Note: The term “baseline“ means that these variables were measured at the beginning of the clinical trial*

```{r}
library(mgcv)
# data separated by tab, fill in missing values
hirsutism <- read.table("hirsutism.dat",header=T, sep="\t",fill=TRUE)
# we're using the variable Treatment as a categorical predictor
hirsutism$Treatment <- as.factor(hirsutism$Treatment)

attach(hirsutism)
summary(hirsutism)
```

### Model 1: the simplest one

Including linear terms allows for the estimation of both linear and nonlinear relationships between the predictors and the response variable:

```{r}
gam_1 <- gam(FGm12 ~ 
             FGm0 + Treatment + SysPres + 
             DiaPres + weight + height,
             data = hirsutism)
summary(gam_1)
```

```{r}
# gam.check(gam_1)
```

-   **p-value:** None of the following are statistically significant (p \> 0.05): `SysPres`, `DiaPres`, `weight`, `height`.

-   **R-squared (adjusted):** The model explains around 17% of the variance in `FGm12`. It is low, indicating that a substantial proportion of the variability in `FGm12` is not explained.

-   **Deviance explained:** 24.4%. It has some explanatory potential.

-   **Number of observations:** notice that the `gam` functions removes the 8 observations with missing values. So `n=91`.

We'll start the refinements by adding the nonlinear terms.

### Model 2: Adding Nonlinear Terms

-   Variable `Treatment` is a factor, so it doesn't have to be smoothed.

```{r}
gam_2 <- gam(FGm12 ~ 
             s(FGm0) + Treatment + s(SysPres) + 
             s(DiaPres) + s(weight) + s(height),
             data = hirsutism)
summary(gam_2)
```

-   **p-value:** None of the following are statistically significant (p \> 0.05): `SysPres`, `DiaPres`, `weight`, `height`.

-   **R-squared (adjusted):** The model explains around 17% of the variance in `FGm12`. It is low, indicating that a substantial proportion of the variability in `FGm12` is not explained.

-   **Deviance explained:** 24.4%. It has some explanatory potential.

### Model n-1: joining

-   We fit jointly weight and height by `te(weight,heigth)` in order to capture the physical effect.

### Model n

The variables `weight` and `DiaPres` for diastolic pressure have large $p$-values so we may remove them from the model. We also apply smoothing to the non-factor variables.

```{r}
# excluding the variables `DiaPres` and `weight`
gam_n <- gam(FGm12 ~ s(FGm0) + Treatment + 
               s(SysPres) + s(height), 
             data = hirsutism)

```
