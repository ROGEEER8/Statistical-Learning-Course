---
title: 'Assignment 2: Lasso and GLM'
author: "Víctor Villegas, Roger Llorenç, Luis Sierra"
date: "2024-02-27"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Loading the necessary libraries and preparing the datasets. This time, we will be using a modified version of the Boston dataset, as well as two biological datasets.

```{r}
library(glmnet)
Boston <- load("boston.Rdata")
express <- read.csv("journal.pbio.0020108.sd012.CSV",header=FALSE)
surv <- read.csv("journal.pbio.0020108.sd013.CSV",header=FALSE)

death <- (surv[,2]==1)
log.surv <- log(surv[death,1]+.05)
expr <- as.matrix(t(express[,death]))
```

# 1. Lasso for the Boston Housing data

```{r}
anyNA(boston.c)
Y <- scale(boston.c$CMEDV, center=TRUE, scale=FALSE)
X <- scale(as.matrix(boston.c[,8:20]), center=TRUE, scale=TRUE) # Exclude response variable

p <- dim(X)[1]
n <- dim(X)[2]
```

```{r}
#Y <- scale(Boston$medv, center=TRUE, scale=FALSE) # Center but no rescaling on the response
X <- as.matrix(boston.c[,8:20]) # Center and rescaling,
n <- dim(X)[1]
p <- dim(X)[2]
```

# 2. A regression model with $p>>n$:

Using *glmnet* we shall fit, using LASSO with different shrinkage parameters, the logarithm of the survival time against a large set of gene expressions.

### 2.1. In the following two figures we show the optimal value of $\lambda$

```{r}
fit <- glmnet(expr, log.surv)
```

```{r}
plot(fit)
```

Selecting the best shrinkage parameter $\lambda$ by cross validation

```{r}
cvfit <- cv.glmnet(expr, log.surv)
```

```{r}
plot(cvfit)
```

```{r}
cvfit$lambda.min
cvfit$lambda.1se
coefs_min <- coef(cvfit, s = "lambda.min")
coefs_reg <- coef(cvfit, s = "lambda.1se")
coefs_min@i
coefs_reg@i
```

Only three coefficients are different from zero for the minimum PMSE, and note that for the 1-SE values, the coefficients are all zero and we are left with the null model (always predict the intercept).

### 2.2.

```{r}
Y_hat <- predict(cvfit, newx = expr, s = "lambda.min")
barplot(log.surv, Y_hat)
```

### 2.3. OLS with non-zero coefficients set $S_0$ from Lasso fit

```{r}
S_0 <- coefs_min@i # S_0[1] is intercept
ols_model <- lm(log.surv ~ expr[,S_0[2]] + expr[,S_0[3]] + expr[,S_0[4]])
coefs_ols <- ols_model$coefficients
coefs_ols
coefs_min@x
```

### 2.4. Comparing fitted Lasso and OLS coefficients:

```{r}
coef_names <- c("Intercept", "G2252", "G3787", "G5352")
names(coefs_ols) <- coef_names
#coefs_ols
#coefs_min@x
barplot(rbind(coefs_ols, coefs_min@x), xlab='Gene Coefficients', col=c("darkblue","red"), beside=TRUE)
```


